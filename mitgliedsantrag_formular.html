<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Mitgliedsantrag</title>

  <!-- ✅ Korrekte EmailJS SDK -->
 <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
<script type="text/javascript">
  window.emailjs = emailjs;
  emailjs.init("vGtRi_YowVHTWMd5F");
</script>

  <!-- jsPDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <style>
    body {
      background-color: #eee;
      font-family: sans-serif;
      padding: 2rem;
    }
    form {
      max-width: 500px;
      margin: auto;
      background: #fff;
      padding: 2rem;
      border-radius: 8px;
    }
    input, select, label {
      display: block;
      width: 100%;
      margin-bottom: 1rem;
      padding: 0.5rem;
    }
    button {
      background-color: #333;
      color: white;
      padding: 0.7rem;
      border: none;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h2>Antrag auf Mitgliedschaft</h2>
  <form id="membershipForm">
    <input type="text" name="name" placeholder="Name / Vorname / Firma" required>
    <input type="text" name="strasse" placeholder="Straße" required>
    <input type="text" name="ort" placeholder="PLZ / Ort" required>
    <input type="text" name="telefon" placeholder="Telefon">
    <input type="text" name="mobil" placeholder="Mobil">
    <input type="email" name="email" placeholder="E-Mail" required>
    <input type="text" name="spende" placeholder="Jährliche Spende (optional)">
    <label>Spendenquittung gewünscht:
      <select name="quittung">
        <option>Ja</option>
        <option>Nein</option>
      </select>
    </label>
    <label>Zahlweise:
      <select name="zahlung">
        <option>Abbuchung</option>
        <option>Überweisung</option>
      </select>
    </label>
    <label>
      <input type="checkbox" name="dsgvo" required> Ich stimme der Datenschutzerklärung zu.
    </label>
    <button type="submit">Absenden</button>
  </form>

  <script>
    document.getElementById("membershipForm").addEventListener("submit", async function(event) {
      event.preventDefault();
      const form = event.target;
      const data = Object.fromEntries(new FormData(form).entries());

      // PDF generieren mit jsPDF
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      doc.text("Mitgliedsantrag", 10, 10);
      doc.text(`Name: ${data.name}`, 10, 20);
      doc.text(`Straße: ${data.strasse}`, 10, 30);
      doc.text(`Ort: ${data.ort}`, 10, 40);
      doc.text(`Telefon: ${data.telefon}`, 10, 50);
      doc.text(`Mobil: ${data.mobil}`, 10, 60);
      doc.text(`E-Mail: ${data.email}`, 10, 70);
      doc.text(`Spende: ${data.spende}`, 10, 80);
      doc.text(`Spendenquittung: ${data.quittung}`, 10, 90);
      doc.text(`Zahlweise: ${data.zahlung}`, 10, 100);
      doc.text(`Datum: ${new Date().toLocaleDateString()}`, 10, 110);

      const pdfBase64 = doc.output("datauristring").split(",")[1];

      emailjs.send("service_j48xjti", "template_fnjec28", {
        ...data,
        pdf_attachment: pdfBase64
      }).then(() => {
        alert("Antrag erfolgreich übermittelt!");
        form.reset();
      }, (error) => {
        alert("Fehler beim Versenden: " + error.text);
      });
    });
  </script>
</body>
</html>
